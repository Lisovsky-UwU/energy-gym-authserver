import{l as u,A as c}from"./index-61c05336.js";import{u as h}from"./user-a74740c1.js";const i=u(),r=h(),g=c("apiStudent",{state:()=>({studentToken:null}),getters:{isLogin(){return this.studentToken!=null}},actions:{async checkStudentCard(e){return(await this.doRequest("/auth/check-studcard","POST",{studentCard:e})).alreadyExists},async checkLogin(){if(this.studentToken=localStorage.getItem("studentToken"),this.studentToken!=null){const e=await this.doRequest("/auth/check-login","GET");r.set(e)}},async login(e,o){const s=await this.doRequest("/auth/login","POST",{login:e,password:o});this.studentToken=s.token,r.set(s.userData),localStorage.setItem("studentToken",this.studentToken)},async registrate(e){const o=await this.doRequest("/auth/signup","POST",e);this.studentToken=o.token,r.set(o.userData),localStorage.setItem("studentToken",this.studentToken)},logout(){this.studentToken=null,r.invalidate(),localStorage.removeItem("studentToken")},async doRequest(e,o,s=null){let a={method:o,headers:{}};s!=null&&(a.headers["content-type"]="application/json",a.body=JSON.stringify(s)),this.studentToken!=null&&(a.headers.Authorization=this.studentToken);try{var n=await fetch(`/api/v1${e}`,a)}catch(t){throw i.showError("Незвестная ошибка запроса к серверу"),console.error(t),t}if(n.status!=200){n.status==401&&this.logout();const t=await n.json();throw i.showError(t.errorMessage),console.error(t),new Error(`(${t.errorType}) ${t.errorMessage}`)}else return(await n.json()).data}}}),T=c("apiCoach",{state:()=>({coachToken:null}),getters:{isLogin(){return this.coachToken!=null}},actions:{async checkLogin(){if(this.coachToken=localStorage.getItem("coachToken"),this.coachToken!=null){const e=await this.doRequest("/auth/check-login","GET");console.log(e),r.set(e)}},async login(e,o){const s=await this.doRequest("/auth/login/coach","POST",{login:e,password:o});this.coachToken=s.token,r.set(s.userData),localStorage.setItem("coachToken",this.coachToken)},logout(){this.coachToken=null,r.invalidate(),localStorage.removeItem("coachToken")},async doRequest(e,o,s=null){let a={method:o,headers:{}};s!=null&&(a.headers["content-type"]="application/json",a.body=JSON.stringify(s)),this.coachToken!=null&&(a.headers.Authorization=this.coachToken);try{var n=await fetch(`/api/v1${e}`,a)}catch(t){throw i.showError("Незвестная ошибка запроса к серверу"),console.error(t),t}if(n.status!=200){n.status==401&&this.logout();const t=await n.json();throw i.showError(t.errorMessage),console.error(t),new Error(`(${t.errorType}) ${t.errorMessage}`)}else return n.headers.get("Content-Type")=="application/json"?(await n.json()).data:await n.blob()}}});export{T as useApiCoachStore,g as useApiStudentStore};
