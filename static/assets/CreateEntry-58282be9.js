import{j,S,k as N}from"./mdi-24228410.js";import{M as V}from"./MainBlockLkTemplate-acedb296.js";import{L as W}from"./Loading-e76d4d20.js";import{L as M}from"./LoadingSmall-d4448cd8.js";import{u as F}from"./user-f854f47d.js";import{u as K}from"./entry-90a42a53.js";import{A as q,d as z,l as G,r as T,m as C,o as R,a as e,s as E,w as U,c as l,e as g,u as a,b as m,F as v,h as A,t as b,n as L,g as I,f as _,p as H,k as J}from"./index-d7d45e2a.js";import{useApiStudentStore as P}from"./api-a7f55192.js";import{w as $}from"./Common-654e7287.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";const X=P(),Y=q("availableTime",{state:()=>({availableTimes:[]}),getters:{mappedAvTimesAboutWeekdays(){const o=[];return this.availableTimes.forEach(t=>{let u=o.find(p=>p.weekday==t.weekday);u===void 0&&(u={id:o.length,weekday:t.weekday,times:[]},o.push(u)),u.times.push(t)}),o},mappedAvTimes(){const o={};return this.availableTimes.forEach(t=>{o[t.id]=t}),o}},actions:{async loadAvailableTimes(){this.availableTimes=await X.doRequest("/avtime/get","GET")}}}),B=o=>(H("data-v-af6f618c"),o=o(),J(),o),Z=B(()=>m("div",{class:"bg-select-entry-1 bg-select-entry-2 bg-select-entry-3 bg-select-entry-4"},null,-1)),ee={key:0,class:"flex items-center sm:h-full sm:absolute justify-center text-2xl py-6 w-full"},te={key:1,class:"flex flex-col gap-3 items-center sm:h-full sm:absolute justify-center text-2xl py-6 w-full"},se=B(()=>m("span",{class:"text-center"},[_(" Вы были заблокированы за пропуски занятий"),m("br"),_(" Вы не сможете записаться на следующий месяц ")],-1)),ae={key:2},oe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 p-4 place-items-stretch pb-[78px]"},re={class:"text-lg col-span-2"},le=["onClick"],ie=["onClick"],ne={key:3,class:"flex flex-col gap-3 items-center sm:h-full sm:absolute justify-center text-2xl py-6 w-full"},de={class:"text-center"},ce={key:4,class:"w-full min-h-[68px] absolute bottom-0 bg-second flex flex-row-reverse py-3 pr-3 rounded-b-md"},ue=["disabled"],pe=z({__name:"CreateEntry",setup(o){const t=K(),u=Y(),p=G(),x=F(),h=T(!0),f=T(!1);let i=C({});R(async()=>{if(x.role!="BLOCKED")try{await t.loadOpen(),t.registrateIsOpen&&await u.loadAvailableTimes()}finally{h.value=!1}else h.value=!1});function w(n,d){n in i?d==i[n]?delete i[n]:i[n]=d:Object.keys(i).length>=3?p.showError("Выбрано максимальное количество дней для записи"):i[n]=d}function O(){const n=[];for(var d in i)n.push(i[d]);if(n.length==0){p.showError("Выберите хотя бы одно время для записи");return}f.value=!0,u.loadAvailableTimes().finally(()=>{}),t.createEntries(n).then(s=>{if(s.some(r=>r.error)){let r=s.filter(c=>c.error==!1),y=s.filter(c=>c.error==!0);if(r.length==0)p.showError("Все места на выбранные времена закончились, записи не были созданы",!1);else{let c="Закончились места на времена:<br>";y.forEach(D=>{const k=u.mappedAvTimes[D.selectedTime];c+=`${$[k.weekday]} - ${k.time}<br>`}),c+="На остальные времена вы были записаны",p.showWarning(c,!1)}}else p.showSuccess("Вы успешно были записаны на выбранные времена");i=C({})}).finally(()=>{f.value=!1})}return(n,d)=>(e(),E(V,{title:"Запись в спортзал"},{default:U(()=>[Z,h.value?(e(),l("div",ee,[g(W)])):a(x).role=="BLOCKED"?(e(),l("div",te,[g(a(S),{class:"text-red-600 h-20 w-20",type:"mdi",path:a(j)},null,8,["path"]),se])):a(t).registrateIsOpen?(e(),l("div",ae,[m("div",oe,[(e(!0),l(v,null,A(a(u).mappedAvTimesAboutWeekdays,s=>(e(),l("div",{key:"wd-"+s.id,class:"bg-white shadow-md rounded-md text-center grid grid-cols-2 grid-rows-3 p-4 gap-2 border border-gray-300"},[m("span",re,b(a($)[s.weekday]),1),(e(!0),l(v,null,A(s.times,(r,y)=>(e(),l(v,{key:`${s.id}-${r.id}`},[r.available?s.id in a(i)&&r.id==a(i)[s.id]?(e(),l("button",{key:2,class:L("bg-select-entry-"+(y+1)+" w-full py-2 text-white rounded-md text-base font-bold"),onClick:c=>w(s.id,r.id)},b(r.time),11,ie)):(e(),l("button",{key:1,class:"w-full py-2 bg-second text-white rounded-md text-base font-bold",onClick:c=>w(s.id,r.id)},b(r.time),9,le)):(e(),l("button",{key:0,class:"w-full py-2 bg-gray-400 text-gray-200 rounded-md text-base font-bold",onClick:d[0]||(d[0]=c=>a(p).showWarning("На выбранное время закончились места"))},b(r.time),1))],64))),128))]))),128))])])):(e(),l("div",ne,[g(a(S),{class:"text-primary h-20 w-20",type:"mdi",path:a(N)},null,8,["path"]),m("span",de," Запись закрыта. Откроется "+b(a(t).openingDay)+" числа. ",1)])),a(t).registrateIsOpen&&!h.value?(e(),l("div",ce,[m("button",{disabled:f.value,class:L(f.value?"bg-tertiary-hover text-white px-12 py-2 rounded-md uppercase text-lg font-semibold":"bg-tertiary text-white px-12 py-2 rounded-md uppercase text-lg font-semibold hover:bg-tertiary-hover transition-all"),onClick:d[1]||(d[1]=s=>O())},[f.value?(e(),E(M,{key:0})):I("",!0),_(" Записаться ")],10,ue)])):I("",!0)]),_:1}))}});const ke=Q(pe,[["__scopeId","data-v-af6f618c"]]);export{ke as default};
